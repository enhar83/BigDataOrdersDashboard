@model List<CountryReportDto>

<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
<style>
	.dashboard-container {
		display: flex;
		flex-wrap: wrap;
		gap: 20px;
	}

	.map-container {
		flex: 2;
		min-width: 600px;
		height: 500px;
		border-radius: 10px;
		overflow: hidden;
		box-shadow: 0 3px 10px rgba(0,0,0,0.1);
	}

	.table-container {
		flex: 1;
		min-width: 400px;
		background: #fff;
		border-radius: 10px;
		box-shadow: 0 3px 10px rgba(0,0,0,0.1);
		padding: 15px;
	}

		.table-container table {
			width: 100%;
			border-collapse: collapse;
		}

		.table-container th, .table-container td {
			padding: 10px;
			text-align: left;
		}

		.table-container th {
			background: #f5f5f5;
		}

	.positive {
		color: green;
		font-weight: bold;
	}

	.negative {
		color: red;
		font-weight: bold;
	}
</style>

<div class="dashboard-container">
	<!-- Harita -->
	<div id="map" class="map-container"></div>

	<!-- Tablo -->
	<div class="table-container">
		<h3>Ülke İstatistikleri</h3>
		<table>
			<thead>
				<tr>
					<th>Ülke</th>
					<th>2023</th>
					<th>2024</th>
					<th>Değişim</th>
				</tr>
			</thead>
			<tbody>
				@foreach (var item in Model)
				{
					<tr>
						<td>@item.Country</td>
						<td>@item.Total2023</td>
						<td>@item.Total2024</td>
						<td>
							@if (item.ChangeRate >= 0)
							{
								<span class="positive">+@item.ChangeRate.ToString("N2") % ⬆</span>
							}
							else
							{
								<span class="negative">@item.ChangeRate.ToString("N2") % ⬇</span>
							}
						</td>
					</tr>
				}
			</tbody>
		</table>
	</div>
</div>

<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script>
	// DB'den gelen veriler (artık Lat/Lon da içeriyor)
	var data = @Html.Raw(System.Text.Json.JsonSerializer.Serialize(Model));

	// Harita oluştur
	var map = L.map('map').setView([45, 10], 4); // Avrupa odaklı başlangıç

	// OpenStreetMap katmanı
	L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
		maxZoom: 19
	}).addTo(map);

	// Marker ekleme
	data.forEach(x => {
		if (x.Latitude && x.Longitude) {
			var popupContent = `
				<b>${x.Country}</b><br>
				2023: ${x.Total2023}<br>
				2024: ${x.Total2024}<br>
				Değişim: ${x.ChangeRate} %
			`;
			var marker = L.circleMarker([x.Latitude, x.Longitude], {
				radius: 10,
				fillColor: x.ChangeRate >= 0 ? "green" : "red",
				color: "#fff",
				weight: 2,
				opacity: 1,
				fillOpacity: 0.8
			}).addTo(map);
			marker.bindPopup(popupContent);
		}
	});
</script>